# Infrastructure & Implementation Notes

> **Purpose:** Clarifies infrastructure requirements for roadmap implementation  
> **Last Updated:** November 2025

---

## üö´ NO USER REGISTRATION OR ACCOUNTS NEEDED

**The #1 constraint:** Nobody is going to sign up or register for anything.

**How it works instead:**
- All 13 fan names are **hardcoded** in the site (already there)
- Predictions use a **dropdown with 13 names** (Brian D., David K., etc.)
- User picks their name ‚Üí makes prediction ‚Üí submits
- **No passwords, no login, no authentication, no signup**
- Honor system works for 13 people who all know each other
- Same trust model Sleeper uses for private leagues

**This is fundamental to the design.** Every feature works without any user accounts.

---

## ‚úÖ No Replatforming Required

**Good news:** All P0 features can be implemented using the **existing GitHub Pages + GitHub Actions** infrastructure. No cloud databases, external services, or replatforming needed.

---

## üèóÔ∏è Current Architecture (Stays the Same)

```
GitHub Repository
  ‚îú‚îÄ‚ñ∫ Ruby Scripts (data processing)
  ‚îú‚îÄ‚ñ∫ GitHub Actions (automation every 3 hours)
  ‚îú‚îÄ‚ñ∫ Static Site Generation (HTML/CSS/JS)
  ‚îú‚îÄ‚ñ∫ JSON Data Files (in _site/ and data/)
  ‚îî‚îÄ‚ñ∫ GitHub Pages (hosting)
```

**This architecture is sufficient for all P0 features.**

---

## üìä How Each P0 Feature Works (No External Services)

### 1. Enhanced Trend Charts ‚úÖ Zero Infrastructure Change

**Storage:** Use existing `standings_history.json` file (already working)

**Implementation:**
- Enhance `StandingsHistoryTracker` to add more fields to existing JSON
- Add Chart.js code to `lib/standings.html.erb` (client-side only)
- No server, no database, no external services needed

**Data Flow:**
```
GitHub Actions (every 3h)
  ‚Üí Ruby script adds data to standings_history.json
  ‚Üí Commit to repo
  ‚Üí GitHub Pages serves updated JSON
  ‚Üí Browser fetches and renders charts
```

**Cost:** $0 (uses existing infrastructure)

---

### 2. Game Predictions System ‚úÖ File-Based Storage

**Storage:** New `data/predictions.json` file (same pattern as standings_history.json)

**‚ùå NO USER ACCOUNTS OR REGISTRATION NEEDED**
- No signup, no login, no authentication required
- Uses fan names from existing `data/fans.json` (13 hardcoded people)
- Simple dropdown: "Pick your fan name ‚Üí Select winner ‚Üí Submit"
- Zero friction for the 13 people who already use the site

**Implementation:**
- Ruby classes store predictions in JSON files
- GitHub Actions process predictions every hour
- UI reads/writes via localStorage and JSON files
- No database needed

**How Voting Works (No Registration):**
1. User opens page ‚Üí sees dropdown of 13 fan names (Brian D., David K., etc.)
2. Selects their name + prediction ‚Üí clicks submit
3. JavaScript writes to `data/predictions.json` via simple form
4. GitHub Action commits the change
5. Prediction appears on leaderboard immediately

**Why No Authentication:**
- 13 people who all know each other (private league)
- Honor system works for small groups
- Same pattern as Sleeper uses for private leagues
- If someone cheats, everyone will know (group accountability)

**Cost:** $0 (uses existing infrastructure)

---

### 3. Real-Time Score Updates ‚úÖ Polling-Based

**Storage:** New `_site/live_games.json` file (generated by GitHub Actions)

**Implementation:**
- GitHub Actions runs every 1-5 minutes during game windows
- Fetches NHL API data
- Writes to `live_games.json`
- JavaScript polls this file every 60 seconds
- No WebSockets, no server, no database

**Data Flow:**
```
GitHub Actions (every 1-5 min during games)
  ‚Üí Fetch NHL API
  ‚Üí Update _site/live_games.json
  ‚Üí Commit & push
  ‚Üí GitHub Pages serves fresh data
  ‚Üí JavaScript polls every 60 sec
```

**Cost:** $0 (uses existing infrastructure + NHL API is free)

---

## üîÑ Data Storage Strategy (No Database Needed)

### All Data Stored in JSON Files

| Feature | File | Size | Update Frequency |
|---------|------|------|------------------|
| Standings | `_site/index.html` | ~300KB | Every 3 hours |
| History | `data/standings_history.json` | ~10KB | Every 3 hours |
| Predictions | `data/predictions.json` | ~5KB | Every hour |
| Live Scores | `_site/live_games.json` | ~3KB | Every 1-5 min (games only) |

**Total Data:** ~320KB (tiny for 13 users)

**Why This Works:**
- Small user base (13 people, not 13,000)
- Read-heavy workload (more viewing than writing)
- GitHub handles version control and atomic commits
- No concurrency issues with 13 users

---

## üöÄ GitHub Actions Usage

### Current Usage
- 1 workflow running every 3 hours = ~8 runs/day
- ~5 minutes per run
- ~40 minutes/day total

### With P0 Features
- Standings: Every 3 hours (unchanged)
- Predictions: Every hour during season = +24 runs/day, ~2 min each = +48 min/day
- Live Scores: Every 5 minutes during games (7-11 PM) = ~48 runs/day, ~30 sec each = +24 min/day

**Total:** ~112 minutes/day = ~3,360 minutes/month

**GitHub Free Tier:** 2,000 minutes/month for free (for public repos)

**Options:**
1. **Increase poll interval** - Every 10 minutes for live scores = fits in free tier
2. **Optimize runs** - Only run during game windows
3. **GitHub Pro** - $4/month for 3,000 minutes = under free tier with optimizations

**Cost:** $0 (fits in free tier with minor optimizations) or $4/month (GitHub Pro if needed)

---

## üíæ Alternative: GitHub Issues as Database

For predictions/voting, you can use **GitHub Issues API** (free, no external service):

**How It Works:**
```ruby
# lib/prediction_tracker.rb using Octokit (GitHub API)
def store_prediction(fan_name, game_id, predicted_winner)
  # Create issue comment with vote
  client.add_comment(repo, issue_number, "#{fan_name} predicts #{predicted_winner}")
end
```

**Benefits:**
- No JSON file management
- Built-in versioning and history
- Free API calls
- No rate limits for authenticated requests
- Works with existing GitHub infrastructure

**Downsides:**
- Slightly more complex code
- Requires GitHub token (easy to set up)

---

## üîî P1 Feature: Push Notifications

**This is the ONLY feature that might need external service (optional):**

**Option 1: Web Push (Free, No Server)**
- Use browser's native Push API
- Requires service worker (already have)
- Notifications sent from browser, not server
- **Cost:** $0
- **Limitation:** User must have browser open

**Option 2: Firebase Cloud Messaging (Freemium)**
- Send push even when browser closed
- Free tier: Unlimited notifications
- **Cost:** $0 for small usage
- **Setup:** 30 minutes

**Option 3: Skip Push Notifications**
- Focus on browser notifications only
- Still very effective for 13 users who visit site
- **Cost:** $0

**Recommendation:** Start with Option 1 (free, no external service), add Option 2 later if needed.

---

## üì± P1 Feature: Player Stats

**Storage:** New `data/player_stats.json` file

**Implementation:**
- GitHub Actions fetch from NHL API
- Store in JSON file
- No database needed

**Cost:** $0

---

## üéØ Summary: Infrastructure Requirements

### What You DON'T Need:
‚ùå Cloud database (Postgres, MySQL, MongoDB)  
‚ùå Backend server (Node.js, Ruby on Rails)  
‚ùå Cloud hosting (AWS, Azure, GCP)  
‚ùå External APIs (paid services)  
‚ùå Replatforming  
‚ùå **User accounts, registration, or authentication** ‚Üê NO SIGNUP REQUIRED

### What You DO Need (Already Have):
‚úÖ GitHub Pages (free, already using)  
‚úÖ GitHub Actions (free tier sufficient)  
‚úÖ JSON file storage (already working)  
‚úÖ NHL API (free, already using)  
‚úÖ **13 hardcoded fan names** (already in the site)

### How Authentication Works:
**It doesn't.** Honor system for 13 people who know each other.
- Dropdown shows 13 fan names (Brian D., David K., etc.)
- User picks their name and makes prediction
- No passwords, no signup, no login
- Same trust model Sleeper uses for private leagues
- Group accountability prevents cheating (everyone knows everyone)

### Optional (Free):
- GitHub Issues API (for predictions storage)
- Firebase Cloud Messaging (for advanced push, but not required)

---

## üí∞ Cost Analysis

| Feature | Storage | Processing | Cost |
|---------|---------|------------|------|
| Enhanced Charts | JSON files | Client-side | $0 |
| Game Predictions | JSON files or GitHub Issues | GitHub Actions | $0 |
| Real-Time Scores | JSON files | GitHub Actions | $0 |
| Push Notifications | Browser API | Client-side | $0 |
| Player Stats | JSON files | GitHub Actions | $0 |

**Total Cost:** $0/month (stays within GitHub free tier)

**If you exceed free tier:** $4/month for GitHub Pro (3,000 Actions minutes)

---

## üîß Implementation Strategy (No Replatforming)

### Phase 1: Enhanced Charts (Week 1-2)
1. Update `StandingsHistoryTracker` to add fields to existing JSON
2. Add Chart.js code to HTML template
3. Deploy via GitHub Actions (same as now)

**Infrastructure Change:** None

### Phase 2: Game Predictions (Week 3-6)
1. Create `PredictionTracker` to manage `data/predictions.json`
2. Add GitHub Action to process predictions
3. Update UI to show voting interface

**Infrastructure Change:** Add 1 new GitHub Action workflow

### Phase 3: Real-Time Scores (Week 7-10)
1. Create `LiveGameTracker` to generate `_site/live_games.json`
2. Add GitHub Action to run during games
3. Add JavaScript polling in browser

**Infrastructure Change:** Add 1 new GitHub Action workflow (runs more frequently)

---

## üö¶ Optimization: Stay Within Free Tier

### If You Approach GitHub Actions Limit:

**Option 1: Reduce Frequency (Recommended)**
- Live scores: Every 10 minutes instead of 5
- Predictions: Every 2 hours instead of 1
- Still very responsive for 13 users

**Option 2: Conditional Runs**
```yaml
# .github/workflows/live-scores.yml
on:
  schedule:
    - cron: '*/5 19-23 * * *'  # Only 7-11 PM PT
  workflow_dispatch:
```

**Option 3: GitHub Pro ($4/month)**
- 3,000 minutes instead of 2,000
- Worth it if you want real-time (every 1-5 min)

---

## üéØ Recommendation

**Implement all P0 features with zero infrastructure changes:**

1. ‚úÖ Use existing GitHub Pages + Actions
2. ‚úÖ Store everything in JSON files
3. ‚úÖ Optimize GitHub Actions to stay in free tier
4. ‚úÖ No external services needed

**Only consider external services if:**
- You exceed 2,000 Actions minutes/month (then just upgrade to Pro for $4/month)
- You want push notifications when browser is closed (then add Firebase for free)

**Bottom line:** You can implement the entire roadmap for $0/month using your current infrastructure.

---

## üìû Questions?

**Q: Can 13 users really work with file-based storage?**  
A: Absolutely. You're not building Facebook. File-based storage works great for small groups.

**Q: What about race conditions if two users vote at the same time?**  
A: GitHub's atomic commits handle this. With 13 users, conflicts are extremely rare.

**Q: Is polling every 60 seconds "real-time enough"?**  
A: For 13 friends watching hockey, yes. ESPN polls every 30-60 seconds. It's fine.

**Q: Will this scale if the league grows?**  
A: Easily handles 50-100 users. Beyond that, reconsider (but you said you're not going public).

---

**No replatforming. No databases. No Azure/AWS. Just better use of what you already have.** üéâ
